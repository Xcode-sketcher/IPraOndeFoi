<div class="fade-in space-y-8">
  <header>
    <h1 class="text-2xl font-bold text-(--text-primary)">Exportar Dados</h1>
    <p class="text-(--text-secondary)">Baixe seus dados em diferentes formatos.</p>
  </header>

  <!-- Filtros de Período -->
  <div class="bg-(--surface-strong) rounded-3xl p-6 border border-(--border-subtle) shadow-sm">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-lg font-semibold text-(--text-primary)">Período de Exportação</h2>
      <span class="px-3 py-1 rounded-full bg-emerald-100 text-emerald-700 text-xs font-medium">
        {{ periodoDescricao }}
      </span>
    </div>
    <form [formGroup]="filterForm" class="space-y-4">
      <!-- Tipo de Filtro -->
      <div>
        <label class="block text-sm font-medium text-(--text-secondary) mb-2">Selecione o período</label>
        <div class="grid md:grid-cols-3 gap-3">
          <button type="button"
            (click)="filterForm.patchValue({ tipoFiltro: 'todos' })"
            [class.bg-emerald-500]="filterForm.value.tipoFiltro === 'todos'"
            [class.text-white]="filterForm.value.tipoFiltro === 'todos'"
            [class.bg-(--surface)]="filterForm.value.tipoFiltro !== 'todos'"
            [class.text-(--text-primary)]="filterForm.value.tipoFiltro !== 'todos'"
            class="px-4 py-3 rounded-xl border border-(--border-subtle) font-medium transition-all hover:scale-105">
            Todas as Transações
          </button>
          <button type="button"
            (click)="filterForm.patchValue({ tipoFiltro: 'periodo' })"
            [class.bg-emerald-500]="filterForm.value.tipoFiltro === 'periodo'"
            [class.text-white]="filterForm.value.tipoFiltro === 'periodo'"
            [class.bg-(--surface)]="filterForm.value.tipoFiltro !== 'periodo'"
            [class.text-(--text-primary)]="filterForm.value.tipoFiltro !== 'periodo'"
            class="px-4 py-3 rounded-xl border border-(--border-subtle) font-medium transition-all hover:scale-105">
            Período Customizado
          </button>
          <button type="button"
            (click)="filterForm.patchValue({ tipoFiltro: 'mes' })"
            [class.bg-emerald-500]="filterForm.value.tipoFiltro === 'mes'"
            [class.text-white]="filterForm.value.tipoFiltro === 'mes'"
            [class.bg-(--surface)]="filterForm.value.tipoFiltro !== 'mes'"
            [class.text-(--text-primary)]="filterForm.value.tipoFiltro !== 'mes'"
            class="px-4 py-3 rounded-xl border border-(--border-subtle) font-medium transition-all hover:scale-105">
            Mês Específico
          </button>
        </div>
      </div>

      <!-- Período Customizado -->
      <div *ngIf="filterForm.value.tipoFiltro === 'periodo'" class="grid md:grid-cols-2 gap-4">
        <div>
          <label class="block text-xs font-semibold uppercase text-(--text-secondary) mb-2">Data Início</label>
          <input formControlName="dataInicio" type="date"
            class="w-full rounded-xl border border-(--border-subtle) bg-(--surface) px-4 py-3 text-(--text-primary) outline-none focus:border-emerald-500">
          <p class="text-xs text-(--text-tertiary) mt-1">Deixe em branco para desde o início</p>
        </div>
        <div>
          <label class="block text-xs font-semibold uppercase text-(--text-secondary) mb-2">Data Fim</label>
          <input formControlName="dataFim" type="date"
            class="w-full rounded-xl border border-(--border-subtle) bg-(--surface) px-4 py-3 text-(--text-primary) outline-none focus:border-emerald-500">
          <p class="text-xs text-(--text-tertiary) mt-1">Padrão: hoje</p>
        </div>
      </div>

      <!-- Mês Específico -->
      <div *ngIf="filterForm.value.tipoFiltro === 'mes'" class="grid md:grid-cols-2 gap-4">
        <div>
          <label class="block text-xs font-semibold uppercase text-(--text-secondary) mb-2">Mês</label>
          <select formControlName="mes"
            class="w-full rounded-xl border border-(--border-subtle) bg-(--surface) px-4 py-3 text-(--text-primary) outline-none focus:border-emerald-500">
            <option value="01">Janeiro</option>
            <option value="02">Fevereiro</option>
            <option value="03">Março</option>
            <option value="04">Abril</option>
            <option value="05">Maio</option>
            <option value="06">Junho</option>
            <option value="07">Julho</option>
            <option value="08">Agosto</option>
            <option value="09">Setembro</option>
            <option value="10">Outubro</option>
            <option value="11">Novembro</option>
            <option value="12">Dezembro</option>
          </select>
        </div>
        <div>
          <label class="block text-xs font-semibold uppercase text-(--text-secondary) mb-2">Ano</label>
          <input formControlName="ano" type="number" min="2020" max="2030"
            class="w-full rounded-xl border border-(--border-subtle) bg-(--surface) px-4 py-3 text-(--text-primary) outline-none focus:border-emerald-500">
        </div>
      </div>
    </form>
  </div>

  <!-- Success Message -->
  <div *ngIf="exportMessage()"
    class="p-4 rounded-2xl bg-emerald-50 text-emerald-600 border border-emerald-100 flex items-center gap-3">
    <span class="text-xl text-emerald-600">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
        <polyline points="22 4 12 14.01 9 11.01" />
      </svg>
    </span>
    <span>{{ exportMessage() }}</span>
  </div>

  <!-- Error Message -->
  <div *ngIf="exportError()"
    class="p-4 rounded-2xl bg-red-50 text-red-600 border border-red-100 flex items-center gap-3">
    <span class="text-xl text-red-600">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z" />
        <line x1="12" x2="12" y1="9" y2="13" />
        <line x1="12" x2="12.01" y1="17" y2="17" />
      </svg>
    </span>
    <span>{{ exportError() }}</span>
  </div>

  <div class="grid md:grid-cols-3 gap-6">

    <!-- Excel -->
    <div
      class="card p-6 rounded-3xl bg-(--surface-strong) border border-(--border-subtle) hover:border-emerald-500/30 hover:shadow-lg transition-all group cursor-pointer"
      (click)="exportar('excel')" [class.opacity-50]="isExporting()" [class.pointer-events-none]="isExporting()">
      <div
        class="w-14 h-14 rounded-2xl bg-emerald-100 text-emerald-600 flex items-center justify-center text-3xl mb-4 group-hover:scale-110 transition-transform">
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect width="18" height="18" x="3" y="3" rx="2" ry="2" />
          <line x1="3" x2="21" y1="9" y2="9" />
          <line x1="3" x2="21" y1="15" y2="15" />
          <line x1="9" x2="9" y1="3" y2="21" />
          <line x1="15" x2="15" y1="3" y2="21" />
        </svg>
      </div>
      <h3 class="text-lg font-bold text-(--text-primary)">Planilha Excel</h3>
      <p class="text-xs text-(--text-secondary) mt-2">Dados formatados em .xlsx com resumo e estilo profissional.</p>
      <div class="mt-4 pt-4 border-t border-(--border-subtle)">
        <span class="text-xs font-semibold text-emerald-500 flex items-center gap-1">
          <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="currentColor"
            stroke="none">
            <polygon
              points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" />
          </svg> Recomendado
        </span>
      </div>
    </div>

    <!-- CSV -->
    <div
      class="card p-6 rounded-3xl bg-(--surface-strong) border border-(--border-subtle) hover:border-blue-500/30 hover:shadow-lg transition-all group cursor-pointer"
      (click)="exportar('csv')" [class.opacity-50]="isExporting()" [class.pointer-events-none]="isExporting()">
      <div
        class="w-14 h-14 rounded-2xl bg-blue-100 text-blue-600 flex items-center justify-center text-3xl mb-4 group-hover:scale-110 transition-transform">
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z" />
          <polyline points="14 2 14 8 20 8" />
          <line x1="8" x2="16" y1="13" y2="13" />
          <line x1="8" x2="16" y1="17" y2="17" />
          <line x1="8" x2="10" y1="9" y2="9" />
        </svg>
      </div>
      <h3 class="text-lg font-bold text-(--text-primary)">Arquivo CSV</h3>
      <p class="text-xs text-(--text-secondary) mt-2">Formato texto separado por vírgulas, leve e compatível.</p>
    </div>

    <!-- PDF -->
    <div
      class="card p-6 rounded-3xl bg-(--surface-strong) border border-(--border-subtle) hover:border-red-500/30 hover:shadow-lg transition-all group cursor-pointer"
      (click)="exportar('pdf')" [class.opacity-50]="isExporting()" [class.pointer-events-none]="isExporting()">
      <div
        class="w-14 h-14 rounded-2xl bg-red-100 text-red-600 flex items-center justify-center text-3xl mb-4 group-hover:scale-110 transition-transform">
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z" />
          <polyline points="14 2 14 8 20 8" />
          <path d="M9 15h6" />
          <path d="M9 15v3" />
          <path d="M9 15v-3" />
        </svg>
      </div>
      <h3 class="text-lg font-bold text-(--text-primary)">Relatório PDF</h3>
      <p class="text-xs text-(--text-secondary) mt-2">Relatório detalhado para impressão (requer API).</p>
    </div>

  </div>

  <!-- Loading -->
  <div *ngIf="isExporting()"
    class="p-4 rounded-2xl bg-emerald-50 text-emerald-600 border border-emerald-100 text-center">
    <div class="inline-flex items-center gap-3">
      <div class="w-5 h-5 border-2 border-emerald-600 border-t-transparent rounded-full animate-spin"></div>
      <span>Gerando arquivo, aguarde...</span>
    </div>
  </div>
</div>
